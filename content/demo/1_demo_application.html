---
extends: skeleton/_base.html
title: Discrete Labels
---

{% block extra_js %}
    <script src="/media/js/underscore.js"></script>
    <script src="/media/js/jquery.numeric.js"></script>
    <script src="/media/js/client.js"></script>
    <script src="/media/js/gal.js"></script>
    <script src="/media/js/utils.js"></script>
    <script src="/media/js/app.js"></script>
    <script src="/media/js/gal_app.js"></script>
{% endblock %}

{% block content %}

<div class="row-fluid">
    <div class="span12 no-left-margin relative">
    	<ul class="nav nav-tabs smaller" id="menuTab">
		    <li class="active"><a href="#input" data-toggle="tab">Input</a></li>
		    <li><a href="#result" data-toggle="tab">Results</a></li>
	    </ul>
	    <div class="tab-content">
            <div class="tab-pane active" id="input">
                <div class="row" style="margin: inherit;">
                    <div class="span6">
                        <div class="page-header">
                            <h2>1. Algorithm</h2>
                        </div>
                        <p>
                            <select id="id_algorithm_choose" style="width: 300px;" class="select_down">
                                <option value="BDS">Batch DawidSkene, blockingEM</option>
                                <option value="IDS">Incremental DawidSkene, onlineEM</option>
                                <option value="BMV">MajorityVote</option>
                            </select>
                        </p>
                    </div>
                    <div class="span6">
                        <div class="page-header">
                            <h2>2. Initial data</h2>
                        </div>
                        <p>
                            Data set:
                            <select id="id_data_choose" style="width: 300px;" class="select_down">
                                <option value="1">Small pack - 25 worker assigns, 1 gold item</option>
                                <option value="2">Big pack - 5000 worker assigns, 30 gold items</option>
                                <option value="0">Empty</option>
                            </select>
                        </p>
                    </div>
                </div>
                <div class="row" style="margin: inherit;">
		    		<div class="page-header">
		    			<h2>3. Data</h2>
		    		</div>
		    		<p>
		    			<form id="data_form" class="form-horizontal" method="post">
							<ul class="nav nav-tabs" id="dataTab">
								<!--<div class="span7">-->
							    <li class="active"><a href="#data" data-toggle="tab">Data</a></li>
							    <li><a href="#gold" data-toggle="tab">Gold data</a></li>
							    <li><a href="#evaluation" data-toggle="tab">Evaluation</a></li>
                                <li><a href="#matrix" data-toggle="tab">Categories</a></li>
								<!--<div class="span7">-->
						    </ul>
							<div class="tab-content">
								<div class="tab-pane active" id="data">
									<div class="span7 wrapper">
										<div class="control-group content2">
											<textarea id="id_data" class="field span12" rows="15" cols="40" placeholder="worker object class"></textarea>
											<span class="help-inline"></span>
											<h3>Line format:</h3>
											<pre>workerid[tab]objectid[tab]assignedlabel</pre>
										</div>
									</div>
									<div class="span5 well">
										<p>You can use the form below to calculate the quality of the workers that submit answers to your tasks on Mechanical Turk.</p>
										<p>The pre-populated example has five workers (worker1 to worker5), five objects (url1 to url5), and two classes (porn and notporn). The correct (but unknown) label for url1, url3, and url5 is notporn; for url2 and url4 is porn.</p>
										<p>The workers have varying levels of quality.</p>
										<ul>
											<li>worker1 is lazy, and gives the answer porn all the time</li>
											<li>worker2 is ok but not great. For example, labeled object5 as porn even though it is notporn</li>
											<li>worker3 and worker4 are high-quality workers</li>
											<li>worker5 is malicious, giving always the incorrect answer, trying to fool the system</li>
										</ul>

									</div>
								</div>
								<div class="tab-pane" id="gold">
									<div class="span7">
										<div class="control-group">
											<textarea id="id_gold_data" class="field span12" rows="15" cols="40" placeholder="object class"></textarea>
											<span class="help-inline"></span>
											<h3>Line format:</h3>
											<pre>objectid[tab]correctlabel</pre>
										</div>
									</div>
									<div class="span5 well">
										<p>Optionally, you may also provide a few known ("gold") answers. See <a href="http://behind-the-enemy-lines.blogspot.com/2010/09/worker-evaluation-in-crowdsourcing-gold.html">Worker Evaluation in Crowdsourcing: Gold Data or Multiple Workers?</a> for a discussion on how much help we can get from the usage of the "gold" answers.</p>
									</div>
								</div>
                                <div class="tab-pane" id="evaluation">
                                    <div class="span7">
                                        <div class="control-group">
                                            <textarea id="id_evaluation_data" class="field span12" rows="15" cols="40" placeholder="object class"></textarea>
                                            <span class="help-inline"></span>
                                            <h3>Line format:</h3>
                                            <pre>objectid[tab]correctlabel</pre>
                                        </div>
                                    </div>
                                    <div class="span5 well">
                                        <p>You may as well provide a few known answers to check how good is the algorithm answer.</p>
                                    </div>
                                </div>
								<div class="tab-pane" id="matrix" >
                                    <div class="span7">
                                        <h3>Cost matrix</h3>
                                        <div id="cost_matrix"></div>
                                        <h3>Category probabilities</h3>
                                        <div id="category_priors"></div>
                                    </div>
									<div class="span5 well">
										<p>Cost matrix is calculated automaticly based on categories you've entered. You can change the default values.</p>
									</div>
								</div>
							</div>
                            <div class="alert alert-error" style="display:none;">
                                <strong>Error!</strong><p>Troia server not responding.</p>
                            </div>
							<div class="form-actions">
								<span type="button" class="btn btn-info" id="send_data">Process</span>
							</div>
						</form>
		    		</p>
		    	</div>
	    	</div>
	    	<div class="tab-pane" id="result">
				<img src="/media/img/bigrotation.gif" id="img-load" />
	    		<div id="response">
                    <div class="row" style="margin-left: auto; margin-right: auto; padding-right: 0;">
                        <div class="span8">
                            <ul class="nav nav-tabs" id="resultsTab">
                                <li class="active"><a href="#summary" data-toggle="tab">Summary</a></li>
                                <li><a href="#objects" data-toggle="tab">Predicted labels</a></li>
                                <li><a href="#workers" data-toggle="tab">Workers stats</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="tab-content">
                        <div class="tab-pane active" id="summary">
                            <div id="summary-inner" style="display: none;">
                                <div class="row" style="margin: inherit;">
                                    <!-- <div class="span2"></div> -->
                                    <div class="span8">
                                        <div class="page-header">
                                            <h2>Job summary</h2>
                                        </div>
                                        <div id="job_summary"></div>
                                    </div>
                                    <div class="span4">
                                    <!-- <div class="span4" style="text-align: right; margin-left: auto; margin-right: 0"> -->
                                        <span id="download_zip_btn" class="btn btn-info" style="">Download results</span>
                                    </div>
                                </div>
                                <div class="row" style="margin: inherit;">
                                    <div class="span6">
                                        <div class="page-header">
                                            <h2>Objects qualities</h2>
                                        </div>
                                        <div id="objects_summary"></div>
                                    </div>
                                <!-- </div> -->
                                <!-- <div class="row" style="margin: inherit;"> -->
                                    <div class="span6">
                                        <div class="page-header">
                                            <h2>Workers qualities</h2>
                                        </div>
                                        <div id="workers_summary"></div>
                                    </div>
                                </div>
                                <div class="row" style="margin: inherit;">
                                    <div id="url" style="display: none;">
                                        <div class="page-header">
                                            <h2>You can see later your results at</h2>
                                        </div>
                                        <pre style="text-align: center;"></pre>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane" id="objects">
                            <div id="objects"></div>
                        </div>
                        <div class="tab-pane" id="workers">
                            <div id="workers"></div>
                        </div>
                    </div>
		        </div>
	    	</div>
	    </div>

        <!-- Job summary template. -->
        <script type="text/template" id="job_summary_template">
            <div>
                <table>
                    <thead>
                        <tr>
                            <% _.each(_.keys(summary), function(key) { %>
                                <th><%= key %></th>
                            <% }); %>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <% _.each(_.keys(summary), function(key) { %>
                                <td><%= summary[key] %></td>
                            <% }); %>
                        </tr>
                    </tbody>
                </table>
            </div>
        </script>

        <!-- Objects summary template. -->
        <script type="text/template" id="objects_summary_template">
            <div>
                <table>
                    <thead>
                        <tr>
                            <% _.each(_.keys(objects_summary), function(key) { %>
                                <th><%= key %></th>
                            <% }); %>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <% _.each(_.keys(objects_summary), function(key) { %>
                                <td><%= objects_summary[key] %></td>
                            <% }); %>
                        </tr>
                    </tbody>
                </table>
            <div>
        </script>

        <!-- Workers summary template. -->
        <script type="text/template" id="workers_summary_template">
            <div>
                <table>
                    <thead>
                        <tr>
                            <% _.each(_.keys(workers_summary), function(key) { %>
                                <th><%= key %></th>
                            <% }); %>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <% _.each(_.keys(workers_summary), function(key) { %>
                                <td><%= workers_summary[key] %></td>
                            <% }); %>
                        </tr>
                    </tbody>
                </table>
            </div>
        </script>

        <!-- Cost matrix template -->
        <script type="text/template" id="cost_matrix_template">
            <div>
                <table>
                    <tr>
                        <td></td>
                        <% _.each(categories, function(c) { %>
                            <td><%= c %></td>
                        <% }); %>
                    </tr>
                    <% _.each(categories, function(c1) { %>
                        <tr>
                            <td><%= c1 %></td>
                            <% _.each(categories, function(c2) {
                                _.each(data, function(d) {
                                    if (d['from'] === c1 && d['to'] === c2) { %>
                                        <td><input style="width: auto;" value="<%= d['value'] %>"></td>
                            <% }});}); %>
                        </tr>
                    <% }); %>
                </table>
            </div>
        </script>

        <!-- Category priors template -->
        <script type="text/template" id="category_priors_template">
            <div>
                <table>
                    <% _.each(categories, function(c) { %>
                        <tr>
                            <td><%= c %></td>
                            <% _.each(data, function(d) {
                                if (d['categoryName'] === c) { %>
                                    <td><input style="width: auto;" value="<%= d['value'] %>" ></td>
                            <% }}); %>
                        </tr>
                    <% }); %>
                </table>
            </div>
        </script>

        <!-- Classes table template. -->
		<script type="text/template" id="objects_template">
			<div>
                <table>
                    <tr><th>Objects</th>
                    <th>Predicted label</th>
                    <!-- TROIA-368 <% _.each(headers, function(h){  %>
                        <th width="150px"><%= h %></th>
                    <% }); %>
                    </tr> -->
                    <% _.each(_.keys(objects), function(k){ %>
                        <tr>
                            <td><%= k %></td>
                            <% _.each(headers, function(h){
                                if (evaluation[k] !== undefined) {
                                    if (evaluation[k] === objects[k][h]) { %>
                                        <td class="correct">
                                    <% } else { %>
                                        <td class="not_correct">
                                    <% } %>
                                <% } else { %>
                                    <td>
                                <% } %>
                                <%= objects[k][h] %>
                            </td>
                            <% }); %>
                        </tr>
                    <% }); %>
                </table>
			</div>
        </script>

        <!-- Workers table template. -->
        <script type="text/template" id="workers_template">
            <div>
            <table class='table table-striped'>
                <tr>
                    <th rowspan="2">Workers</th>
                    <th colspan="2">Quality</th>
                    <th rowspan="2" width="150px">Confusion Matrix</th>
                    <th rowspan="2" width="100px">Payment</th>
                </tr>
                <tr>
                    <% _.each(headers, function(h){  %>
                        <td width="150px"><%= h %></td>
                    <% }); %>
                </tr>
                <% _.each(_.keys(workers), function(k){ %>
                    <tr>
                        <td><%= k %></td>
                        <% _.each(headers, function(h){ %>
                        <td><%= 100*workers[k][h] %>%</td>
                        <% }); %>
                        <td>
                            <a href="#" class="btn-small" data-content="<%= workers[k]['matrix'] %>" rel="popover"><i class="icon-search"></i></a>
                        </td>
                        <td><%= workers[k].payment %></td>
                    </tr>
                <% }); %>
            </table>
            </div>
        </script>

        <!-- Confusion matrix template. -->
        <script type="text/template" id="confusion_matrix_template">
            <table>
                <tbody>
                    <tr>
                        <td></td>
                        <% 	for (var i = 0; i < categories.length; i++) { %>
                        <td><%= categories[i] %></td>
                        <% } %>
                    </tr>
                    <% 	for (var i = 0; i < categories.length; i++) { %>
                    <tr>
                        <td><%= categories[i] %></td>
                        <% 	for (var j = 0; j < categories.length; j++) {
                                for (var k = 0; k < data.length; k++) {
                                    if (data[k]['from'] === categories[i] && data[k]['to'] === categories[j]) {
                                        %>
                                        <td><%= Math.round(data[k]['value']*100) %>%</td>
                                        <%
                                        break;
                                    }
                                }
                            }
                        %>
                    </tr>
                    <% } %>
                </tbody>
            </table>
        </script>
    </div>
</div>
{% endblock %}
